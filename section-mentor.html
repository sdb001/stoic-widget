<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Stoic Mentor</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,400&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Cormorant Garamond', Georgia, serif;
      background: #191919;
      color: #e8e8e8;
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    .divider-marks {
      color: #555;
      letter-spacing: 12px;
      font-size: 14px;
      margin-bottom: 8px;
    }
    h1 {
      font-size: 20px;
      font-weight: 300;
      letter-spacing: 2px;
      color: #d4d4d4;
      text-transform: uppercase;
    }
    .subtitle {
      font-size: 14px;
      color: #666;
      font-style: italic;
      margin-top: 6px;
    }

    /* API Key Setup */
    .api-setup {
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
      text-align: center;
    }
    .api-setup.hidden { display: none; }
    .api-setup input {
      width: 100%;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 6px;
      padding: 12px 16px;
      color: #d4d4d4;
      font-family: monospace;
      font-size: 13px;
      margin: 12px 0;
    }
    .api-setup input:focus { outline: none; border-color: #555; }
    .api-setup p { color: #888; font-size: 14px; line-height: 1.6; }
    .api-setup a { color: #a78bfa; }

    /* Main Chat Interface */
    .chat-interface { display: none; }
    .chat-interface.active { display: block; }

    /* Input Area */
    .input-area {
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .input-label {
      font-size: 13px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }
    textarea {
      width: 100%;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 6px;
      padding: 14px;
      color: #d4d4d4;
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 15px;
      resize: none;
      min-height: 100px;
    }
    textarea:focus { outline: none; border-color: #555; }
    textarea::placeholder { color: #555; font-style: italic; }

    /* Prompt Buttons */
    .prompt-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }
    .prompt-btn {
      background: #222;
      border: 1px solid #333;
      border-radius: 6px;
      padding: 10px 16px;
      color: #999;
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .prompt-btn:hover {
      background: #2a2a2a;
      border-color: #444;
      color: #d4d4d4;
    }
    .prompt-btn.active {
      background: #333;
      border-color: #555;
      color: #d4d4d4;
    }
    .prompt-btn .icon { font-size: 16px; }

    /* Submit Button */
    .submit-btn {
      width: 100%;
      background: #2a2a2a;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 14px;
      color: #d4d4d4;
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 15px;
      letter-spacing: 1px;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .submit-btn:hover { background: #333; border-color: #555; }
    .submit-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .submit-btn.loading {
      background: #252525;
      color: #888;
    }

    /* Response Area */
    .response-area {
      background: #222;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 20px;
      margin-top: 16px;
      display: none;
    }
    .response-area.active { display: block; }
    .response-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #333;
    }
    .response-header .icon { font-size: 24px; }
    .response-header .title {
      font-size: 14px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .response-content {
      color: #c4c4c4;
      font-size: 15px;
      line-height: 1.8;
      white-space: pre-wrap;
    }
    .response-content strong { color: #d4d4d4; }
    .response-content em { color: #a0a0a0; }

    /* Loading Animation */
    .loading-dots {
      display: inline-flex;
      gap: 4px;
    }
    .loading-dots span {
      width: 6px;
      height: 6px;
      background: #666;
      border-radius: 50%;
      animation: pulse 1.4s ease-in-out infinite;
    }
    .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
    .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes pulse {
      0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
      40% { opacity: 1; transform: scale(1); }
    }

    /* Settings Link */
    .settings-link {
      text-align: center;
      margin-top: 16px;
    }
    .settings-link button {
      background: none;
      border: none;
      color: #555;
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 13px;
      cursor: pointer;
      text-decoration: underline;
    }
    .settings-link button:hover { color: #888; }

    /* Corner Decorations */
    .corner-tl, .corner-tr, .corner-bl, .corner-br {
      position: fixed;
      width: 20px;
      height: 20px;
      border-color: #3a3a3a;
      border-style: solid;
      border-width: 0;
    }
    .corner-tl { top: 12px; left: 12px; border-top-width: 1px; border-left-width: 1px; }
    .corner-tr { top: 12px; right: 12px; border-top-width: 1px; border-right-width: 1px; }
    .corner-bl { bottom: 12px; left: 12px; border-bottom-width: 1px; border-left-width: 1px; }
    .corner-br { bottom: 12px; right: 12px; border-bottom-width: 1px; border-right-width: 1px; }

    /* Button styles */
    .btn {
      background: #333;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 10px 20px;
      color: #d4d4d4;
      font-family: 'Cormorant Garamond', Georgia, serif;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .btn:hover { background: #3a3a3a; border-color: #555; }

    /* Error state */
    .error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 6px;
      padding: 12px 16px;
      color: #f87171;
      font-size: 14px;
      margin-top: 12px;
      display: none;
    }
    .error.active { display: block; }
  </style>
</head>
<body>
  <div class="corner-tl"></div>
  <div class="corner-tr"></div>
  <div class="corner-bl"></div>
  <div class="corner-br"></div>

  <div class="container">
    <div class="header">
      <div class="divider-marks">/ / /</div>
      <h1>AI Stoic Mentor</h1>
      <div class="subtitle">Wisdom from the ancient philosophers</div>
    </div>

    <!-- API Key Setup -->
    <div class="api-setup" id="apiSetup">
      <p>Enter your Anthropic API key to enable the AI mentor.<br>
      <a href="https://console.anthropic.com/api-keys" target="_blank">Get your key here</a> (stored locally only)</p>
      <input type="password" id="apiKeyInput" placeholder="sk-ant-..." />
      <button class="btn" onclick="saveApiKey()">Enable Mentor</button>
    </div>

    <!-- Chat Interface -->
    <div class="chat-interface" id="chatInterface">
      <div class="input-area">
        <div class="input-label">What's troubling you?</div>
        <textarea id="userInput" placeholder="Describe your challenge, frustration, or dilemma..."></textarea>
      </div>

      <div class="prompt-buttons">
        <button class="prompt-btn active" data-mode="reframe" onclick="setMode(this, 'reframe')">
          <span class="icon">&#128260;</span> Reframe
        </button>
        <button class="prompt-btn" data-mode="sages" onclick="setMode(this, 'sages')">
          <span class="icon">&#127963;&#65039;</span> Ask Sages
        </button>
        <button class="prompt-btn" data-mode="control" onclick="setMode(this, 'control')">
          <span class="icon">&#9878;&#65039;</span> Control
        </button>
        <button class="prompt-btn" data-mode="memento" onclick="setMode(this, 'memento')">
          <span class="icon">&#128128;</span> Memento
        </button>
        <button class="prompt-btn" data-mode="amor" onclick="setMode(this, 'amor')">
          <span class="icon">&#128293;</span> Amor Fati
        </button>
      </div>

      <button class="submit-btn" id="submitBtn" onclick="askMentor()">
        Seek Wisdom
      </button>

      <div class="error" id="errorMsg"></div>

      <div class="response-area" id="responseArea">
        <div class="response-header">
          <span class="icon">&#127963;&#65039;</span>
          <span class="title">The Mentor Speaks</span>
        </div>
        <div class="response-content" id="responseContent"></div>
      </div>

      <div class="settings-link">
        <button onclick="showApiSetup()">Change API Key</button>
      </div>
    </div>
  </div>

  <script>
    let currentMode = 'reframe';
    let apiKey = localStorage.getItem('stoic_api_key') || '';

    const systemPrompts = {
      reframe: `You are a Stoic philosophy mentor channeling Marcus Aurelius, Seneca, and Epictetus. Reframe the user's situation through a Stoic lens:

1. OBSERVE: Summarize their situation objectively, without emotional language
2. CONTROL: Identify what is within their control and what is not
3. REFRAME: Offer a Stoic perspective that transforms this challenge into an opportunity for growth
4. PRACTICE: Suggest one concrete action they can take today
5. WISDOM: End with a relevant quote from Marcus Aurelius, Seneca, or Epictetus

Keep the tone warm but direct. Be concise but profound.`,

      sages: `You are channeling three Stoic philosophers to provide wisdom. Based on the user's situation, provide perspective from each:

**Marcus Aurelius** (The Emperor)
As a leader who faced constant challenges while writing Meditations, what would Marcus say? Draw from his writings about duty, impermanence, and inner peace.

**Seneca** (The Advisor)
As a practical philosopher who dealt with politics, wealth, exile, and ultimately death with dignity, what advice would Seneca offer? Be direct and actionable.

**Epictetus** (The Former Slave)
As someone who found complete freedom through philosophy despite being born into bondage, how would Epictetus reframe this? Focus on what is "up to us" versus what is not.

End with one unified insight they would all agree upon.`,

      control: `Apply the Stoic Dichotomy of Control to the user's situation.

**âœ… WITHIN THEIR CONTROL**
List specific thoughts, actions, attitudes, and responses they can control in this situation. Be concrete and actionable.

**âŒ OUTSIDE THEIR CONTROL**
List external events, other people's actions, outcomes, and circumstances they cannot control. Explain why energy spent here is wasted.

**ðŸŽ¯ THE VERDICT**
Based on this analysis, what is the ONE thing they should focus their energy on right now?

End with Epictetus: "Make the best use of what is in your power, and take the rest as it happens."`,

      memento: `Apply the Stoic meditation on mortality (Memento Mori) to the user's situation.

Consider: If this were their last year, month, or weekâ€”would this challenge still consume them?

1. PERSPECTIVE: How does awareness of limited time change the weight of this problem?
2. PRIORITIES: What truly matters when viewed against the backdrop of mortality?
3. REGRET: What would they regret NOT doing if they spent too long on this worry?
4. URGENCY: How can mortality awareness motivate rather than paralyze?

Be compassionate but unflinching. Help them see their concerns in the context of a finite life.

End with Marcus Aurelius: "You could leave life right now. Let that determine what you do and say and think."`,

      amor: `Apply Amor Fati (love of fate) to the user's situation.

The Stoics taught that we should not merely accept what happens, but love itâ€”seeing every event as necessary and beneficial for our growth.

1. ACCEPTANCE: Restate their situation as a neutral fact, completely stripped of judgment
2. NECESSITY: How might this challenge be exactly what was needed for their growth?
3. OPPORTUNITY: What strength, skill, or wisdom can ONLY be developed through this specific difficulty?
4. EMBRACE: Help them write an affirmation that transforms resistance into acceptance

Be profound. Help them see their obstacle as the way.

End with Epictetus: "Do not seek for things to happen the way you want them to; rather, wish that what happens happen the way it happens: then you will be happy."`
    };

    // Initialize
    if (apiKey) {
      document.getElementById('apiSetup').classList.add('hidden');
      document.getElementById('chatInterface').classList.add('active');
    }

    function saveApiKey() {
      const key = document.getElementById('apiKeyInput').value.trim();
      if (key && key.startsWith('sk-')) {
        localStorage.setItem('stoic_api_key', key);
        apiKey = key;
        document.getElementById('apiSetup').classList.add('hidden');
        document.getElementById('chatInterface').classList.add('active');
      }
    }

    function showApiSetup() {
      document.getElementById('apiSetup').classList.remove('hidden');
      document.getElementById('chatInterface').classList.remove('active');
      document.getElementById('apiKeyInput').value = apiKey;
    }

    function setMode(btn, mode) {
      document.querySelectorAll('.prompt-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      currentMode = mode;
    }

    async function askMentor() {
      const input = document.getElementById('userInput').value.trim();
      if (!input) return;

      const submitBtn = document.getElementById('submitBtn');
      const responseArea = document.getElementById('responseArea');
      const responseContent = document.getElementById('responseContent');
      const errorMsg = document.getElementById('errorMsg');

      // Reset state
      errorMsg.classList.remove('active');
      submitBtn.disabled = true;
      submitBtn.classList.add('loading');
      submitBtn.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div> Consulting the sages...';
      responseArea.classList.remove('active');

      try {
        const response = await fetch('https://api.anthropic.com/v1/messages', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-api-key': apiKey,
            'anthropic-version': '2023-06-01',
            'anthropic-dangerous-direct-browser-access': 'true'
          },
          body: JSON.stringify({
            model: 'claude-sonnet-4-20250514',
            max_tokens: 1024,
            system: systemPrompts[currentMode],
            messages: [
              { role: 'user', content: input }
            ]
          })
        });

        if (!response.ok) {
          const err = await response.json();
          throw new Error(err.error?.message || 'API request failed');
        }

        const data = await response.json();
        const text = data.content[0].text;

        // Format response with basic markdown
        const formatted = text
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/\*(.*?)\*/g, '<em>$1</em>')
          .replace(/^### (.*$)/gm, '<strong style="font-size: 16px;">$1</strong>')
          .replace(/^## (.*$)/gm, '<strong style="font-size: 17px;">$1</strong>')
          .replace(/^# (.*$)/gm, '<strong style="font-size: 18px;">$1</strong>');

        responseContent.innerHTML = formatted;
        responseArea.classList.add('active');

      } catch (err) {
        errorMsg.textContent = err.message;
        errorMsg.classList.add('active');
      } finally {
        submitBtn.disabled = false;
        submitBtn.classList.remove('loading');
        submitBtn.textContent = 'Seek Wisdom';
      }
    }

    // Allow Enter+Cmd/Ctrl to submit
    document.getElementById('userInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {
        askMentor();
      }
    });
  </script>
</body>
</html>
